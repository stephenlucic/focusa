{% extends "base.html" %}
{% load static %}

{% block extra_css %}
<link href="{% static 'css/perfil.css' %}" rel="stylesheet">
{% endblock %}

{% block title %}Perfil | Focusa{% endblock %}

{% block content %}

{% if messages %}
  {% for m in messages %}
    <div class="alert alert-{{ m.tags }} perfil-alert d-flex justify-content-between align-items-center px-3 py-2 mb-3">
      <span>{{ m.message }}</span>
      <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
  {% endfor %}
{% endif %}

<div class="card shadow-sm profile-card">
  <div class="card-body">
    <div class="row g-4 align-items-start profile-layout">
      
      <!-- Col izquierda -->
      <div class="col-12 col-lg-4">
        <div class="text-center">
          <div class="profile-avatar mb-3">
            <img src="{% static 'img/foto_perfil_foca.jpg' %}" alt="Foto de perfil">
          </div>
          <h5 class="mb-1">{{ request.user.first_name }} {{ request.user.last_name }}</h5>
          <div class="text-muted small">{{ request.user.email }}</div>
          <div class="text-muted small">{{ request.user.username }}</div>
        </div>
      </div>

      <!-- Divisor -->
      <div class="col-lg-auto d-none d-lg-flex">
        <div class="profile-divider-vertical"></div>
      </div>

      <!-- Col derecha -->
      <div class="col-12 col-lg-7">
        <form id="perfil-form" method="post" class="py-2">
          {% csrf_token %}
          <div class="row g-4">
            <div class="col-12 col-lg-6">
              <label class="form-label">Nombre</label>
              <input name="first_name" class="form-control" value="{{ request.user.first_name }}">
            </div>
            <div class="col-12 col-lg-6">
              <label class="form-label">Apellido</label>
              <input name="last_name" class="form-control" value="{{ request.user.last_name }}">
            </div>
            <div class="col-12 col-lg-6">
              <label class="form-label">Email</label>
              <input type="email" name="email" class="form-control" value="{{ request.user.email }}">
            </div>
            <div class="col-12 col-lg-6">
              <label class="form-label">Teléfono</label>
              <input name="telefono" class="form-control" value="{{ perfil.telefono }}">
            </div>
            <div class="col-12 col-lg-6">
              <label class="form-label">Ocupación</label>
              <input name="ocupacion" class="form-control" value="{{ perfil.ocupacion }}">
            </div>
            <div class="col-12 col-lg-3">
              <label class="form-label">Género</label>
              <select name="genero" class="form-select">
                <option value="">Selecciona…</option>
                <option value="M" {% if perfil.genero == "M" %}selected{% endif %}>Masculino</option>
                <option value="F" {% if perfil.genero == "F" %}selected{% endif %}>Femenino</option>
                <option value="O" {% if perfil.genero == "O" %}selected{% endif %}>Otro</option>
                <option value="N" {% if perfil.genero == "N" %}selected{% endif %}>Prefiero no decir</option>
              </select>
            </div>
            <div class="col-12 col-lg-3">
              <label class="form-label">País</label>
              <input name="pais" class="form-control" value="{{ perfil.pais }}">
            </div>
          </div>
          <div id="action-buttons" class="mt-4">
            <button type="submit" class="btn btn-primary">Guardar</button>
          </div>
        </form>
      </div>

    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
(function(){
  const form = document.getElementById('perfil-form');
  if(!form) return;

  form.addEventListener('submit', function(e){
    e.preventDefault();
    Swal.fire({
      title: '¿Guardar cambios?',
      text: 'Se actualizará tu perfil.',
      icon: 'question',
      showCancelButton: true,
      confirmButtonText: 'Sí, guardar',
      cancelButtonText: 'Cancelar',
      reverseButtons: true,
      focusCancel: true
    }).then((result) => {
      if(result.isConfirmed){
        form.submit();
      }
    });
  });
})();
</script>
{% endblock %}